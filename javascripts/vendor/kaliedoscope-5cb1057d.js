$(document).ready(function(){function e(e){var n=new FileReader;return e.type.match("image/.*")?(n.onload=function(e){v.css("background-image",["url(",e.target.result,")"].join(""))},void n.readAsDataURL(e)):!1}function n(){var e=(new Date).getTime()*[".0000",l].join("");u=Math.sin(e)*document.body.clientWidth,s++,a(u,s),t&&requestAnimFrame(n)}function a(e,n){v.css("background-position",[e+"px",n+"px"].join(" "))}var t,r,i=function(e){var n={},a=e.split("?")[1];return a&&$.each(a.split("&"),function(e,a){var t=a.replace(/\/$/,"").split("="),r=t[0].replace(/^\?/,"");n[r]=t[1]||!0}),n}(location.search),o=0,c=0,u=0,s=0,l=i.s||3,d=~~i.n||7,m="";if(d)for(var f=0;2*d>=f;f++)m+=['<div class="tile t',f,'"><div class="image"></div></div>'].join("");var p=$(".kaleidoscope").addClass("n"+d).append(m),v=p.find(".image"),g=$("#fullscreen"),b=p[0],w=i.src;w&&v.css("background-image",["url(",decodeURIComponent(w),")"].join(""));var F=i.clean;F&&$("body").addClass("clean");var k=parseFloat(i.opacity);k&&p.css("opacity",0).fadeTo(3e3,k);var R=~~i.mode||2;p.mousemove(function(e){o++,c++;var n=e.pageX,i=e.pageY;switch(R){case 1:n=-o,i=e.pageY;break;case 2:n=e.pageX,i=-c;break;case 3:n=o,i=e.pageY;break;case 4:n=e.pageX,i=c;break;case 5:n=o,i=c}a(n,i),t=r=!1}),"draggable"in document.createElement("b")&&window.FileReader&&(b.ondragenter=b.ondragover=function(e){e.preventDefault()},b.ondrop=function(n){e(n.dataTransfer.files[0]),n.preventDefault()}),g.click(function(){(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled)&&(b.requestFullscreen&&b.requestFullscreen(),b.mozRequestFullScreen&&b.mozRequestFullScreen(),b.webkitRequestFullscreen&&b.webkitRequestFullscreen())}),window.requestAnimFrame=function(e){var n="equestAnimationFrame",a=["r","webkitR","mozR"].filter(function(a){return a+n in e})[0]+n;return e[a]||function(n){e.setTimeout(function(){n(+new Date)},1e3/60)}}(window),function q(){setTimeout(function(){q(),t&&!r?(n(),r=!0):t=!0},5e3)}()});